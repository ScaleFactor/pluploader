/**
 * Plupload - multi-runtime File Uploader
 * v2.1.2
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2014-05-14
 */
!function(e,t,n){function i(e){function t(e,t,n){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[e]?i[r[e]]=t:n||(i[e]=t)}var n=e.required_features,i={};return"string"==typeof n?l.each(n.split(/\s*,\s*/),function(e){t(e,!0)}):"object"==typeof n?l.each(n,function(e,n){t(n,e)}):!0===n&&(e.chunk_size&&e.chunk_size>0&&(i.slice_blob=!0),l.isEmptyObj(e.resize)&&!1!==e.multipart||(i.send_binary_string=!0),e.http_method&&(i.use_http_method=e.http_method),l.each(e,function(e,n){t(n,!!e,!0)})),i}function r(e,n,i){switch(e){case"chunk_size":(n=l.parseSize(n))&&(i.send_file_name=!0);break;case"headers":var r={};return"object"==typeof n&&l.each(n,function(e,t){r[t.toLowerCase()]=e}),r;case"http_method":return"PUT"===n.toUpperCase()?"PUT":"POST";case"filters":return"array"===l.typeOf(n)&&(n={mime_types:n}),n.mime_types&&("string"===l.typeOf(n.mime_types)&&(n.mime_types=t.Mime.mimes2extList(n.mime_types)),n.mime_types.regexp=function(e){var t=[];return l.each(e,function(e){l.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(n.mime_types)),n;case"max_file_size":i&&!i.filters&&(i.filters={}),i.filters.max_file_size=n;break;case"multipart":n||(i.send_file_name=!0);break;case"resize":return!!n&&l.extend({preserve_headers:!0,crop:!1},n);case"prevent_duplicates":i&&!i.filters&&(i.filters={}),i.filters.prevent_duplicates=!!n;break;case"unique_names":n&&(i.send_file_name=!0);break;case"container":case"browse_button":case"drop_element":return"container"===e?l.get(n):l.getAll(n)}return n}function s(e){return l.each(e,function(t,n){e[n]=r(n,t,e)}),e}var a=e.setTimeout,o={},l={VERSION:"2.1.2",STOPPED:1,STARTED:2,QUEUED:l.File.QUEUED,UPLOADING:l.File.UPLOADING,FAILED:l.File.FAILED,DONE:l.File.DONE,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,OPTION_ERROR:-800,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,getAll:function(e){var t,n=[];"array"!==l.typeOf(e)&&(e=[e]);for(var i=e.length;i--;)(t=l.get(e[i]))&&n.push(t);return n.length?n:null},get:t.get,each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return e?(""+e).replace(n,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,sprintf:t.sprintf,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var n="";return l.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===n||/\D/.test(e))return l.translate("N/A");var i=Math.pow(1024,4);return e>i?t(e/i,1)+" "+l.translate("tb"):e>(i/=1024)?t(e/i,1)+" "+l.translate("gb"):e>(i/=1024)?t(e/i,1)+" "+l.translate("mb"):e>1024?Math.round(e/1024)+" "+l.translate("kb"):e+" "+l.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,n){var i,r;return i=new l.Uploader(e),r=t.Runtime.thatCan(i.getOption().required_features,n||e.runtimes),i.destroy(),r},addFileFilter:function(e,t){o[e]=t}};l.addFileFilter("mime_types",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:l.FILE_EXTENSION_ERROR,message:l.translate("File extension error."),file:t}),n(!1)):n(!0)}),l.addFileFilter("max_file_size",function(e,t,n){e=l.parseSize(e),void 0!==t.size&&e&&t.size>e?(this.trigger("Error",{code:l.FILE_SIZE_ERROR,message:l.translate("File size error."),file:t}),n(!1)):n(!0)}),l.addFileFilter("prevent_duplicates",function(e,t,n){if(e)for(var i=this.files.length;i--;)if(t.name===this.files[i].name&&t.origSize===this.files[i].origSize)return this.trigger("Error",{code:l.FILE_DUPLICATE_ERROR,message:l.translate("Duplicate file error."),file:t}),void n(!1);n(!0)}),l.Uploader=function(e){function c(){var e,t=this;this.state==l.STARTED&&(T.length&&T.each(function(t,n){return T.remove(n),e=t,!1}),e||l.each(I,function(t){if(t.status==l.QUEUED)return e=t,!1}),e?t.uploadFile(e):w.length||(this.state!==l.STOPPED&&(this.state=l.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",I)))}function f(){var e,t;for(z.reset(),e=0;e<I.length;e++)t=I[e],t.size!==n?(z.size+=t.origSize,z.loaded+=t.loaded*t.origSize/t.size):z.size=n,t.status==l.DONE?z.uploaded++:t.status==l.FAILED?z.failed++:z.queued++;z.size===n?z.percent=I.length>0?Math.ceil(z.uploaded/I.length*100):0:(z.bytesPerSec=Math.ceil(z.loaded/((+new Date-O||1)/1e3)),z.percent=z.size>0?Math.ceil(z.loaded/z.size*100):0)}function p(){var e=F[0]||U[0];return!!e&&e.getRuntime().uid}function h(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged"),e.refresh()}),this.bind("CancelUpload",y),this.bind("BeforeUpload",_),this.bind("UploadProgress",m),this.bind("StateChanged",b),this.bind("QueueChanged",f),this.bind("Error",v),this.bind("FileUploaded",E),this.bind("Destroy",R)}function g(e,n){var i=this,r=0,s=[],a={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:D,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};l.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(a[t]=e[t])}),e.browse_button&&l.each(e.browse_button,function(n){s.push(function(s){var o=new t.FileInput(l.extend({},a,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:n}));o.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(i.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),r++,F.push(this),s()},o.onchange=function(){i.addFile(this.files)},o.bind("mouseenter mouseleave mousedown mouseup",function(i){x||(e.browse_button_hover&&("mouseenter"===i.type?t.addClass(n,e.browse_button_hover):"mouseleave"===i.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&("mousedown"===i.type?t.addClass(n,e.browse_button_active):"mouseup"===i.type&&t.removeClass(n,e.browse_button_active)))}),o.bind("mousedown",function(){i.trigger("Browse")}),o.bind("error runtimeerror",function(){o=null,s()}),o.init()})}),e.drop_element&&l.each(e.drop_element,function(e){s.push(function(n){var s=new t.FileDrop(l.extend({},a,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(i.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")}),r++,U.push(this),n()},s.ondrop=function(){i.addFile(this.files)},s.bind("error runtimeerror",function(){s=null,n()}),s.init()})}),t.inSeries(s,function(){"function"==typeof n&&n(r)})}function _(e,t){if(e.settings.unique_names){var n=t.name.match(/\.([^.]+)$/),i="part";n&&(i=n[1]),t.target_name=t.id+"."+i}}function m(){f()}function E(e,t){w.remove(t.id),f(),a(function(){c.call(e)},1)}function b(e){if(e.state==l.STARTED)O=+new Date;else if(e.state==l.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==l.UPLOADING&&(e.files[t].status=l.QUEUED,f())}function y(){w.length&&w.each(function(e){e.cancelUpload()}),w.clear()}function v(e,t){t.code===l.INIT_ERROR?e.destroy():t.code===l.HTTP_ERROR&&(f(),e.state==l.STARTED&&(e.trigger("CancelUpload"),a(function(){c.call(e)},1)))}function R(e){e.stop(),l.each(I,function(e){e.destroy()}),I=[],F.length&&(l.each(F,function(e){e.destroy()}),F=[]),U.length&&(l.each(U,function(e){e.destroy()}),U=[]),w.clear(),T.clear(),D={},x=!1,O=null,z.reset()}var e,O,z,S=l.guid(),I=[],w=new d,T=new d,D={},F=[],U=[],x=!1;e=l.extend({runtimes:t.Runtime.order,multi_selection:!0,flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:!1,prevent_duplicates:!1,max_file_size:0},max_upload_slots:1,multipart:!0,multipart_params:{},http_method:"POST",file_data_name:"file",chunk_size:0,send_file_name:!0,send_chunk_number:!0,max_retries:0,retry_interval:1,resize:!1},s(l.extend({},e))),e.required_features=i(l.extend({},e)),D=i(l.extend({},e,{required_features:!0})),z=new u,l.extend(this,{id:S,uid:S,state:l.STOPPED,features:{},runtime:null,files:I,settings:e,total:z,init:function(){var n,i,r=this;return n=r.getOption("preinit"),"function"==typeof n?n(r):l.each(n,function(e,t){r.bind(t,e)}),h.call(r),l.each(["container","browse_button","drop_element"],function(e){if(null===r.getOption(e))return i={code:l.INIT_ERROR,message:l.sprintf(l.translate("%s specified, but cannot be found."),e)},!1}),i?r.trigger("Error",i):e.browse_button||e.drop_element?void g.call(r,e,function(e){var n=r.getOption("init");if("function"==typeof n?n(r):l.each(n,function(e,t){r.bind(t,e)}),e){var i=t.Runtime.getInfo(p());r.trigger("Init",{ruid:i.uid,runtime:r.runtime=i.type}),r.trigger("PostInit")}else r.trigger("Error",{code:l.INIT_ERROR,message:l.translate("Init error.")})}):r.trigger("Error",{code:l.INIT_ERROR,message:l.translate("You must specify either browse_button or drop_element.")})},setOption:function(t,n){var i=this;if("object"==typeof t)return void l.each(t,function(e,t){i.setOption(t,e)});var s=e[t];if(-1!==l.inArray(t,["container","browse_button","drop_element","runtimes","multi_selection","flash_swf_url","silverlight_xap_url"]))return void this.trigger("Error",{code:l.OPTION_ERROR,message:l.sprintf(l.translate("%s option cannot be changed.")),option:t});e[t]=r(t,n,e),i.trigger("OptionChanged",t,n,s)},getOption:function(t){return t?e[t]:e},refresh:function(){F.length&&l.each(F,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=l.STARTED&&(this.state=l.STARTED,this.trigger("StateChanged"),c.call(this))},stop:function(){this.state!=l.STOPPED&&(this.state=l.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){x=arguments[0]===n||arguments[0],F.length&&l.each(F,function(e){e.disable(x)}),this.trigger("DisableBrowse",x)},uploadFile:function(e,t){var n=this,i=n.getOption("max_upload_slots");"string"==typeof e&&(e=this.getFile(e)),w.length<i?(n.trigger("BeforeUpload",e)&&(w.add(e.id,e),e.upload(t||n.getOption()),n.trigger("UploadFile",e)),w.length<i&&a(function(){c.call(n)})):T.add(e.id,e)},getFile:function(e){var t;for(t=I.length-1;t>=0;t--)if(I[t].id===e)return I[t]},addFile:function(e,n){function i(e){e.bind("progress",function(){d.trigger("UploadProgress",e)}),e.bind("uploaded",function(t,n){d.trigger("FileUploaded",e,n)}),e.bind("error",function(t,n){n.file=e,d.trigger("Error",n)})}function r(e,n){var i=[];t.each(d.settings.filters,function(t,n){o[n]&&i.push(function(i){o[n].call(d,t,e,function(e){i(!e)})})}),t.inSeries(i,n)}function s(e){var o=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!u)return!1;e.ruid=u,e.connectRuntime(u)}s(new l.File(e))}else e instanceof t.Blob?(s(e.getSource()),e.destroy()):e instanceof l.File?(n&&(e.name=n),e.name=e.name.replace(/[&$@=;:+,?\\{^}%`\]>\["~'<#|]/g,"").replace(/\s/g,"_"),c.push(function(t){r(e,function(n){n||(i(e),I.push(e),f.push(e),d.trigger("FileFiltered",e)),a(t,1)})})):-1!==t.inArray(o,["file","blob"])?s(new t.File(null,e)):"node"===o&&"filelist"===t.typeOf(e.files)?t.each(e.files,s):"array"===o&&(n=null,t.each(e,s))}var u,d=this,c=[],f=[];u=p(),s(e),c.length&&t.inSeries(c,function(){f.length&&d.trigger("FilesAdded",f)})},removeFile:function(e){for(var t="string"==typeof e?e:e.id,n=I.length-1;n>=0;n--)if(I[n].id===t)return this.splice(n,1)[0]},splice:function(e,t){var i=I.splice(e===n?0:e,t===n?I.length:t),r=!1;return this.state==l.STARTED&&(l.each(i,function(e){if(e.status===l.UPLOADING)return r=!0,!1}),r&&this.stop()),this.trigger("FilesRemoved",i),l.each(i,function(e){e.destroy()}),r&&this.start(),i},dispatchEvent:function(e){var t,n;if(e=e.toLowerCase(),t=this.hasEventListener(e)){t.sort(function(e,t){return t.priority-e.priority}),n=[].slice.call(arguments),n.shift(),n.unshift(this);for(var i=0;i<t.length;i++)if(!1===t[i].fn.apply(t[i].scope,n))return!1}return!0},bind:function(e,t,n,i){l.Uploader.prototype.bind.call(this,e,t,i,n)},destroy:function(){this.trigger("Destroy"),e=z=null,this.unbindAll()}})},l.Uploader.prototype=t.EventTarget.instance,l.File=function(){function e(s){function o(e,n){if(e.ruid){var i=t.Runtime.getInfo(e.ruid);if(i)return i.can(n)}return!1}function u(e,i,r){var s=new t.Image;try{s.onload=function(){if(i.width>this.width&&i.height>this.height&&i.quality===n&&i.preserve_headers&&!i.crop)return this.destroy(),r(e);s.downsize(i.width,i.height,i.crop,i.preserve_headers)},s.onresize=function(){r(this.getAsBlob(e.type,i.quality)),this.destroy()},s.onerror=function(){r(e)},s.load(e)}catch(t){r(e)}}var d,c,f=l.guid();d={multipart:!0,multipart_params:{},http_method:"POST",headers:!1,file_data_name:"file",chunk_size:0,send_file_name:!0,send_chunk_number:!0,max_retries:0,retry_interval:1,resize:!1},l.extend(this,{id:f,uid:f,name:s.name||s.fileName,type:s.type||"",size:s.size||s.fileSize,origSize:s.size||s.fileSize,loaded:0,percent:0,status:e.QUEUED,lastModifiedDate:s.lastModifiedDate||(new Date).toLocaleString(),isImage:function(){return-1!==t.inArray(this.type,["image/jpeg","image/png"])},getNative:function(){var e=this.getSource().getSource();return-1!==t.inArray(t.typeOf(e),["blob","file"])?e:null},getSource:function(){return i[this.id]?i[this.id]:null},getOption:function(e){return e?d[e]:d},setOption:function(e,t){var n=this;if("object"==typeof e)return void l.each(e,function(e,t){n.setOption(t,e)});d[e]=r(e,t,d),n.trigger("OptionChanged",e,t,oldValue)},upload:function(e){function n(){g-- >0?a(i,1e3*_):(r.loaded=m,r.status=l.FAILED,r.trigger("Error",{code:l.HTTP_ERROR,message:l.translate("HTTP Error."),response:c.responseText,status:c.status,responseHeaders:c.getAllResponseHeaders()}))}function i(){var e,o,u,_=d.url,E={};d.send_file_name&&(E.name=r.target_name||r.name),h&&f&&s.size>h?(u=Math.min(h,s.size-m),e=s.slice(m,m+u)):(u=s.size,e=s),h&&f&&(d.send_chunk_number?(E.chunk=Math.ceil(m/h),E.chunks=Math.ceil(s.size/h)):(E.offset=m,E.total=s.size)),c=new t.XMLHttpRequest,c.upload&&(c.upload.onprogress=function(e){r.loaded=Math.min(r.size,m+e.loaded),r.size&&(r.percent=Math.ceil(r.loaded/r.size*100)),r.trigger(e)}),c.onload=function(){if(c.status>=400)return void n();g=d.max_retries,u<s.size?(e.destroy(),m+=u,r.loaded=Math.min(m,s.size),r.percent=Math.ceil(r.loaded/r.size*100),r.trigger("ChunkUploaded",{offset:r.loaded,total:s.size,response:c.responseText,status:c.status,responseHeaders:c.getAllResponseHeaders()}),"Android Browser"===t.Env.browser&&r.trigger({type:"Progress",loaded:r.loaded,total:s.size})):r.loaded=r.size,e=o=null,!m||m>=s.size?(r.size!=r.origSize&&(s.destroy(),s=null),r.percent=100,r.trigger({type:"Progress",loaded:r.loaded,total:r.size}),r.status=l.DONE,r.trigger("Uploaded",{response:c.responseText,status:c.status,responseHeaders:c.getAllResponseHeaders()})):a(i,1)},c.onerror=function(){n()},c.onloadend=function(){this.destroy(),c=null},d.multipart&&p?(c.open(d.http_method,_,!0),l.each(d.headers,function(e,t){c.setRequestHeader(t,e)}),o=new t.FormData,l.each(l.extend(E,d.multipart_params),function(e,t){o.append(t,e)}),o.append(d.file_data_name,e),c.send(o)):(_=l.buildUrl(d.url,l.extend(E,d.multipart_params)),c.open(d.http_method,_,!0),!l.isEmptyObj(d.headers)&&d.headers["content-type"]||c.setRequestHeader("content-type","application/octet-stream"),l.each(d.headers,function(e,t){c.setRequestHeader(t,e)}),c.send(e))}d=l.extend(d,e);var r=this,s=r.getSource(),f=o(s,"slice_blob"),p=o(s,"send_multipart"),h=d.chunk_size,g=d.max_retries,_=d.retry_interval,m=0;r.status=l.UPLOADING,r.loaded&&(m=r.loaded=h*Math.floor(r.loaded/h)),!l.isEmptyObj(d.resize)&&r.isImage()&&o(s,"send_binary_string")?u.call(this,s,d.resize,function(e){s=e,r.size=e.size,i()}):i()},cancelUpload:function(){c&&(c.abort(),c.destroy(),c=null)},destroy:function(){this.cancelUpload(),this.unbindAll();var e=this.getSource();e&&(e.destroy(),delete i[this.id]),d=null}}),i[this.id]=s}var i={};return l.extend(e,{QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,RESIZING:6}),e.prototype=t.EventTarget.instance,e}();var u=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},d=function(){var e={};this.length=0,this.get=function(t){return e.hasOwnProperty(t)?e[t]:null},this.add=function(t,n){if(e.hasOwnProperty(t))return this.update.apply(this,arguments);e[t]=n,this.length++},this.remove=function(t){e.hasOwnProperty(t)&&(delete e[t],this.length--)},this.update=function(t,n){e[t]=n},this.each=function(t){l.each(e,t)},this.clear=function(){e={},this.length=0}};e.plupload=l}(window,mOxie);