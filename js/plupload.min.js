/**
 * Plupload - multi-runtime File Uploader
 * v2.1.2
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2014-05-14
 */
/**
 * Plupload.js
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 */

/*global mOxie:true */
(function(window,o,undef){var delay=window.setTimeout,fileFilters={};function normalizeCaps(settings){var features=settings.required_features,caps={};function resolve(feature,value,strict){var map={chunks:'slice_blob',jpgresize:'send_binary_string',pngresize:'send_binary_string',progress:'report_upload_progress',multi_selection:'select_multiple',dragdrop:'drag_and_drop',drop_element:'drag_and_drop',headers:'send_custom_headers',urlstream_upload:'send_binary_string',canSendBinary:'send_binary',triggerDialog:'summon_file_dialog'};if(map[feature]){caps[map[feature]]=value}else if(!strict){caps[feature]=value}}
if(typeof(features)==='string'){plupload.each(features.split(/\s*,\s*/),function(feature){resolve(feature,!0)})}else if(typeof(features)==='object'){plupload.each(features,function(value,feature){resolve(feature,value)})}else if(features===!0){if(settings.chunk_size&&settings.chunk_size>0){caps.slice_blob=!0}
if(!plupload.isEmptyObj(settings.resize)||settings.multipart===!1){caps.send_binary_string=!0}
if(settings.http_method){caps.use_http_method=settings.http_method}
plupload.each(settings,function(value,feature){resolve(feature,!!value,!0)})}
return caps}
function normalizeOption(option,value,options){switch(option){case 'chunk_size':if(value=plupload.parseSize(value)){options.send_file_name=!0}
break;case 'headers':var headers={};if(typeof(value)==='object'){plupload.each(value,function(value,key){headers[key.toLowerCase()]=value})}
return headers;case 'http_method':return value.toUpperCase()==='PUT'?'PUT':'POST';case 'filters':if(plupload.typeOf(value)==='array'){value={mime_types:value}}
if(value.mime_types){if(plupload.typeOf(value.mime_types)==='string'){value.mime_types=o.Mime.mimes2extList(value.mime_types)}
value.mime_types.regexp=(function(filters){var extensionsRegExp=[];plupload.each(filters,function(filter){plupload.each(filter.extensions.split(/,/),function(ext){if(/^\s*\*\s*$/.test(ext)){extensionsRegExp.push('\\.*')}else{extensionsRegExp.push('\\.'+ext.replace(new RegExp('['+('/^$.*+?|()[]{}\\'.replace(/./g,'\\$&'))+']','g'),'\\$&'))}})});return new RegExp('('+extensionsRegExp.join('|')+')$','i')}(value.mime_types))}
return value;case 'max_file_size':if(options&&!options.filters){options.filters={}}
options.filters.max_file_size=value;break;case 'multipart':if(!value){options.send_file_name=!0}
break;case 'resize':if(value){return plupload.extend({preserve_headers:!0,crop:!1},value)}
return!1;case 'prevent_duplicates':if(options&&!options.filters){options.filters={}}
options.filters.prevent_duplicates=!!value;break;case 'unique_names':if(value){options.send_file_name=!0}
break;case 'container':case 'browse_button':case 'drop_element':return'container'===option?plupload.get(value):plupload.getAll(value)}
return value}
function normalizeOptions(options){plupload.each(options,function(value,option){options[option]=normalizeOption(option,value,options)});return options}
var plupload={VERSION:'@@version@@',STOPPED:1,STARTED:2,QUEUED:plupload.File.QUEUED,UPLOADING:plupload.File.UPLOADING,FAILED:plupload.File.FAILED,DONE:plupload.File.DONE,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,OPTION_ERROR:-800,mimeTypes:o.mimes,ua:o.ua,typeOf:o.typeOf,extend:o.extend,guid:o.guid,getAll:function get(ids){var els=[],el;if(plupload.typeOf(ids)!=='array'){ids=[ids]}
var i=ids.length;while(i--){el=plupload.get(ids[i]);if(el){els.push(el)}}
return els.length?els:null},get:o.get,each:o.each,getPos:o.getPos,getSize:o.getSize,xmlEncode:function(str){var xmlEncodeChars={'<':'lt','>':'gt','&':'amp','"':'quot','\'':'#39'},xmlEncodeRegExp=/[<>&\"\']/g;return str?(''+str).replace(xmlEncodeRegExp,function(chr){return xmlEncodeChars[chr]?'&'+xmlEncodeChars[chr]+';':chr}):str},toArray:o.toArray,inArray:o.inArray,addI18n:o.addI18n,translate:o.translate,sprintf:o.sprintf,isEmptyObj:o.isEmptyObj,hasClass:o.hasClass,addClass:o.addClass,removeClass:o.removeClass,getStyle:o.getStyle,addEvent:o.addEvent,removeEvent:o.removeEvent,removeAllEvents:o.removeAllEvents,cleanName:function(name){var i,lookup;lookup=[/[\300-\306]/g,'A',/[\340-\346]/g,'a',/\307/g,'C',/\347/g,'c',/[\310-\313]/g,'E',/[\350-\353]/g,'e',/[\314-\317]/g,'I',/[\354-\357]/g,'i',/\321/g,'N',/\361/g,'n',/[\322-\330]/g,'O',/[\362-\370]/g,'o',/[\331-\334]/g,'U',/[\371-\374]/g,'u'];for(i=0;i<lookup.length;i+=2){name=name.replace(lookup[i],lookup[i+1])}
name=name.replace(/\s+/g,'_');name=name.replace(/[^a-z0-9_\-\.]+/gi,'');return name},buildUrl:function(url,items){var query='';plupload.each(items,function(value,name){query+=(query?'&':'')+encodeURIComponent(name)+'='+encodeURIComponent(value)});if(query){url+=(url.indexOf('?')>0?'&':'?')+query}
return url},formatSize:function(size){if(size===undef||/\D/.test(size)){return plupload.translate('N/A')}
function round(num,precision){return Math.round(num*Math.pow(10,precision))/Math.pow(10,precision)}
var boundary=Math.pow(1024,4);if(size>boundary){return round(size/boundary,1)+" "+plupload.translate('tb')}
if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('gb')}
if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('mb')}
if(size>1024){return Math.round(size/1024)+" "+plupload.translate('kb')}
return size+" "+plupload.translate('b')},parseSize:o.parseSizeStr,predictRuntime:function(config,runtimes){var up,runtime;up=new plupload.Uploader(config);runtime=o.Runtime.thatCan(up.getOption().required_features,runtimes||config.runtimes);up.destroy();return runtime},addFileFilter:function(name,cb){fileFilters[name]=cb}};plupload.addFileFilter('mime_types',function(filters,file,cb){if(filters.length&&!filters.regexp.test(file.name)){this.trigger('Error',{code:plupload.FILE_EXTENSION_ERROR,message:plupload.translate('File extension error.'),file:file});cb(!1)}else{cb(!0)}});plupload.addFileFilter('max_file_size',function(maxSize,file,cb){var undef;maxSize=plupload.parseSize(maxSize);if(file.size!==undef&&maxSize&&file.size>maxSize){this.trigger('Error',{code:plupload.FILE_SIZE_ERROR,message:plupload.translate('File size error.'),file:file});cb(!1)}else{cb(!0)}});plupload.addFileFilter('prevent_duplicates',function(value,file,cb){if(value){var ii=this.files.length;while(ii--){if(file.name===this.files[ii].name&&file.origSize===this.files[ii].origSize){this.trigger('Error',{code:plupload.FILE_DUPLICATE_ERROR,message:plupload.translate('Duplicate file error.'),file:file});cb(!1);return}}}
cb(!0)});plupload.Uploader=function(settings){var uid=plupload.guid(),settings,files=[],activeUploads=new Collection(),pendingUploads=new Collection(),preferred_caps={},fileInputs=[],fileDrops=[],startTime,total,disabled=!1;settings=plupload.extend({runtimes:o.Runtime.order,multi_selection:!0,flash_swf_url:'js/Moxie.swf',silverlight_xap_url:'js/Moxie.xap',filters:{mime_types:!1,prevent_duplicates:!1,max_file_size:0},max_upload_slots:1,multipart:!0,multipart_params:{},http_method:'POST',file_data_name:'file',chunk_size:0,send_file_name:!0,send_chunk_number:!0,max_retries:0,retry_interval:1,resize:!1},normalizeOptions(plupload.extend({},settings)));settings.required_features=normalizeCaps(plupload.extend({},settings));preferred_caps=normalizeCaps(plupload.extend({},settings,{required_features:!0}));total=new QueueProgress();plupload.extend(this,{id:uid,uid:uid,state:plupload.STOPPED,features:{},runtime:null,files:files,settings:settings,total:total,init:function(){var self=this,opt,preinitOpt,err;preinitOpt=self.getOption('preinit');if(typeof(preinitOpt)=="function"){preinitOpt(self)}else{plupload.each(preinitOpt,function(func,name){self.bind(name,func)})}
bindEventListeners.call(self);plupload.each(['container','browse_button','drop_element'],function(el){if(self.getOption(el)===null){err={code:plupload.INIT_ERROR,message:plupload.sprintf(plupload.translate("%s specified, but cannot be found."),el)}
return!1}});if(err){return self.trigger('Error',err)}
if(!settings.browse_button&&!settings.drop_element){return self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate("You must specify either browse_button or drop_element.")})}
initControls.call(self,settings,function(inited){var initOpt=self.getOption('init');if(typeof(initOpt)=="function"){initOpt(self)}else{plupload.each(initOpt,function(func,name){self.bind(name,func)})}
if(inited){var runtime=o.Runtime.getInfo(getRUID());self.trigger('Init',{ruid:runtime.uid,runtime:self.runtime=runtime.type});self.trigger('PostInit')}else{self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')})}})},setOption:function(option,value){var self=this;if(typeof(option)==='object'){plupload.each(option,function(value,option){self.setOption(option,value)});return}
var oldValue=settings[option];if(plupload.inArray(option,['container','browse_button','drop_element','runtimes','multi_selection','flash_swf_url','silverlight_xap_url'])!==-1){this.trigger('Error',{code:plupload.OPTION_ERROR,message:plupload.sprintf(plupload.translate("%s option cannot be changed.")),option:option});return}
settings[option]=normalizeOption(option,value,settings);self.trigger('OptionChanged',option,value,oldValue)},getOption:function(option){if(!option){return settings}
return settings[option]},refresh:function(){if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.trigger('Refresh')})}
this.trigger('Refresh')},start:function(){if(this.state!=plupload.STARTED){this.state=plupload.STARTED;this.trigger('StateChanged');uploadNext.call(this)}},stop:function(){if(this.state!=plupload.STOPPED){this.state=plupload.STOPPED;this.trigger('StateChanged');this.trigger('CancelUpload')}},disableBrowse:function(){disabled=arguments[0]!==undef?arguments[0]:!0;if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.disable(disabled)})}
this.trigger('DisableBrowse',disabled)},uploadFile:function(file,options){var up=this,maxSlots=up.getOption('max_upload_slots');if(typeof(file)==='string'){file=this.getFile(file)}
if(activeUploads.length<maxSlots){if(up.trigger('BeforeUpload',file)){activeUploads.add(file.id,file);file.upload(options||up.getOption());up.trigger('UploadFile',file)}
if(activeUploads.length<maxSlots){delay(function(){uploadNext.call(up)})}}else{pendingUploads.add(file.id,file)}},getFile:function(id){var i;for(i=files.length-1;i>=0;i--){if(files[i].id===id){return files[i]}}},addFile:function(file,fileName){var self=this,queue=[],filesAdded=[],ruid;function bindListeners(file){file.bind('progress',function(){self.trigger('UploadProgress',file)});file.bind('uploaded',function(e,args){self.trigger('FileUploaded',file,args)});file.bind('error',function(e,err){err.file=file;self.trigger('Error',err)})}
function filterFile(file,cb){var queue=[];o.each(self.settings.filters,function(rule,name){if(fileFilters[name]){queue.push(function(cb){fileFilters[name].call(self,rule,file,function(res){cb(!res)})})}});o.inSeries(queue,cb)}
function resolveFile(file){var type=o.typeOf(file);if(file instanceof o.File){if(!file.ruid&&!file.isDetached()){if(!ruid){return!1}
file.ruid=ruid;file.connectRuntime(ruid)}
resolveFile(new plupload.File(file))}
else if(file instanceof o.Blob){resolveFile(file.getSource());file.destroy()}
else if(file instanceof plupload.File){if(fileName){file.name=fileName}
file.name=file.name.replace(/[&$@=;:+,?\\{^}%`\]>\["~'<#|]/g,'').replace(/\s/g,'_');queue.push(function(cb){filterFile(file,function(err){if(!err){bindListeners(file);files.push(file);filesAdded.push(file);self.trigger("FileFiltered",file)}
delay(cb,1)})})}
else if(o.inArray(type,['file','blob'])!==-1){resolveFile(new o.File(null,file))}
else if(type==='node'&&o.typeOf(file.files)==='filelist'){o.each(file.files,resolveFile)}
else if(type==='array'){fileName=null;o.each(file,resolveFile)}}
ruid=getRUID();resolveFile(file);if(queue.length){o.inSeries(queue,function(){if(filesAdded.length){self.trigger("FilesAdded",filesAdded)}})}},removeFile:function(file){var id=typeof(file)==='string'?file:file.id;for(var i=files.length-1;i>=0;i--){if(files[i].id===id){return this.splice(i,1)[0]}}},splice:function(start,length){var removed=files.splice(start===undef?0:start,length===undef?files.length:length);var restartRequired=!1;if(this.state==plupload.STARTED){plupload.each(removed,function(file){if(file.status===plupload.UPLOADING){restartRequired=!0;return!1}});if(restartRequired){this.stop()}}
this.trigger("FilesRemoved",removed);plupload.each(removed,function(file){file.destroy()});if(restartRequired){this.start()}
return removed},dispatchEvent:function(type){var list,args,result;type=type.toLowerCase();list=this.hasEventListener(type);if(list){list.sort(function(a,b){return b.priority-a.priority});args=[].slice.call(arguments);args.shift();args.unshift(this);for(var i=0;i<list.length;i++){if(list[i].fn.apply(list[i].scope,args)===!1){return!1}}}
return!0},bind:function(name,fn,scope,priority){plupload.Uploader.prototype.bind.call(this,name,fn,priority,scope)},destroy:function(){this.trigger('Destroy');settings=total=null;this.unbindAll()}});function uploadNext(){var up=this,nextFile;if(this.state==plupload.STARTED){if(pendingUploads.length){pendingUploads.each(function(file,id){pendingUploads.remove(id);nextFile=file;return!1})}
if(!nextFile){plupload.each(files,function(file){if(file.status==plupload.QUEUED){nextFile=file;return!1}})}
if(nextFile){up.uploadFile(nextFile)}else if(!activeUploads.length){if(this.state!==plupload.STOPPED){this.state=plupload.STOPPED;this.trigger("StateChanged")}
this.trigger("UploadComplete",files)}}}
function calc(){var i,file;total.reset();for(i=0;i<files.length;i++){file=files[i];if(file.size!==undef){total.size+=file.origSize;total.loaded+=file.loaded*file.origSize/file.size}else{total.size=undef}
if(file.status==plupload.DONE){total.uploaded++}else if(file.status==plupload.FAILED){total.failed++}else{total.queued++}}
if(total.size===undef){total.percent=files.length>0?Math.ceil(total.uploaded/files.length*100):0}else{total.bytesPerSec=Math.ceil(total.loaded/((+new Date()-startTime||1)/1000.0));total.percent=total.size>0?Math.ceil(total.loaded/total.size*100):0}}
function getRUID(){var ctrl=fileInputs[0]||fileDrops[0];if(ctrl){return ctrl.getRuntime().uid}
return!1}
function bindEventListeners(){this.bind('FilesAdded FilesRemoved',function(up){up.trigger('QueueChanged');up.refresh()});this.bind('CancelUpload',onCancelUpload);this.bind('BeforeUpload',onBeforeUpload);this.bind('UploadProgress',onUploadProgress);this.bind('StateChanged',onStateChanged);this.bind('QueueChanged',calc);this.bind('Error',onError);this.bind('FileUploaded',onFileUploaded);this.bind('Destroy',onDestroy)}
function initControls(settings,cb){var self=this,inited=0,queue=[];var options={runtime_order:settings.runtimes,required_caps:settings.required_features,preferred_caps:preferred_caps,swf_url:settings.flash_swf_url,xap_url:settings.silverlight_xap_url};plupload.each(settings.runtimes.split(/\s*,\s*/),function(runtime){if(settings[runtime]){options[runtime]=settings[runtime]}});if(settings.browse_button){plupload.each(settings.browse_button,function(el){queue.push(function(cb){var fileInput=new o.FileInput(plupload.extend({},options,{accept:settings.filters.mime_types,name:settings.file_data_name,multiple:settings.multi_selection,container:settings.container,browse_button:el}));fileInput.onready=function(){var info=o.Runtime.getInfo(this.ruid);o.extend(self.features,{chunks:info.can('slice_blob'),multipart:info.can('send_multipart'),multi_selection:info.can('select_multiple')});inited++;fileInputs.push(this);cb()};fileInput.onchange=function(){self.addFile(this.files)};fileInput.bind('mouseenter mouseleave mousedown mouseup',function(e){if(!disabled){if(settings.browse_button_hover){if('mouseenter'===e.type){o.addClass(el,settings.browse_button_hover)}else if('mouseleave'===e.type){o.removeClass(el,settings.browse_button_hover)}}
if(settings.browse_button_active){if('mousedown'===e.type){o.addClass(el,settings.browse_button_active)}else if('mouseup'===e.type){o.removeClass(el,settings.browse_button_active)}}}});fileInput.bind('mousedown',function(){self.trigger('Browse')});fileInput.bind('error runtimeerror',function(){fileInput=null;cb()});fileInput.init()})})}
if(settings.drop_element){plupload.each(settings.drop_element,function(el){queue.push(function(cb){var fileDrop=new o.FileDrop(plupload.extend({},options,{drop_zone:el}));fileDrop.onready=function(){var info=o.Runtime.getInfo(this.ruid);o.extend(self.features,{chunks:info.can('slice_blob'),multipart:info.can('send_multipart'),dragdrop:info.can('drag_and_drop')});inited++;fileDrops.push(this);cb()};fileDrop.ondrop=function(){self.addFile(this.files)};fileDrop.bind('error runtimeerror',function(){fileDrop=null;cb()});fileDrop.init()})})}
o.inSeries(queue,function(){if(typeof(cb)==='function'){cb(inited)}})}
function onBeforeUpload(up,file){if(up.settings.unique_names){var matches=file.name.match(/\.([^.]+)$/),ext="part";if(matches){ext=matches[1]}
file.target_name=file.id+'.'+ext}}
function onUploadProgress(){calc()}
function onFileUploaded(up,file){activeUploads.remove(file.id);calc();delay(function(){uploadNext.call(up)},1)}
function onStateChanged(up){if(up.state==plupload.STARTED){startTime=(+new Date())}else if(up.state==plupload.STOPPED){for(var i=up.files.length-1;i>=0;i--){if(up.files[i].status==plupload.UPLOADING){up.files[i].status=plupload.QUEUED;calc()}}}}
function onCancelUpload(){if(activeUploads.length){activeUploads.each(function(file){file.cancelUpload()})}
activeUploads.clear()}
function onError(up,err){if(err.code===plupload.INIT_ERROR){up.destroy()}
else if(err.code===plupload.HTTP_ERROR){calc();if(up.state==plupload.STARTED){up.trigger('CancelUpload');delay(function(){uploadNext.call(up)},1)}}}
function onDestroy(up){up.stop();plupload.each(files,function(file){file.destroy()});files=[];if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.destroy()});fileInputs=[]}
if(fileDrops.length){plupload.each(fileDrops,function(fileDrop){fileDrop.destroy()});fileDrops=[]}
activeUploads.clear();pendingUploads.clear();preferred_caps={};disabled=!1;startTime=null;total.reset()}};plupload.Uploader.prototype=o.EventTarget.instance;plupload.File=(function(){var filepool={};function PluploadFile(file){var uid=plupload.guid(),_options,xhr;_options={multipart:!0,multipart_params:{},http_method:'POST',headers:!1,file_data_name:'file',chunk_size:0,send_file_name:!0,send_chunk_number:!0,max_retries:0,retry_interval:1,resize:!1};plupload.extend(this,{id:uid,uid:uid,name:file.name||file.fileName,type:file.type||'',size:file.size||file.fileSize,origSize:file.size||file.fileSize,loaded:0,percent:0,status:PluploadFile.QUEUED,lastModifiedDate:file.lastModifiedDate||(new Date()).toLocaleString(),isImage:function(){return o.inArray(this.type,['image/jpeg','image/png'])!==-1},getNative:function(){var file=this.getSource().getSource();return o.inArray(o.typeOf(file),['blob','file'])!==-1?file:null},getSource:function(){if(!filepool[this.id]){return null}
return filepool[this.id]},getOption:function(option){if(!option){return _options}
return _options[option]},setOption:function(option,value){var self=this;if(typeof(option)==='object'){plupload.each(option,function(value,option){self.setOption(option,value)});return}
_options[option]=normalizeOption(option,value,_options);self.trigger('OptionChanged',option,value,oldValue)},upload:function(options){_options=plupload.extend(_options,options);var file=this,blob=file.getSource(),canSliceBlob=runtimeCan(blob,'slice_blob'),canSendMultipart=runtimeCan(blob,'send_multipart'),chunkSize=_options.chunk_size,retries=_options.max_retries,interval=_options.retry_interval,offset=0;file.status=plupload.UPLOADING;function handleError(){if(retries-->0){delay(uploadNextChunk,interval*1000)}else{file.loaded=offset;file.status=plupload.FAILED;file.trigger('Error',{code:plupload.HTTP_ERROR,message:plupload.translate('HTTP Error.'),response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()})}}
function uploadNextChunk(){var chunkBlob,formData,url=_options.url,data={},curChunkSize;if(_options.send_file_name){data.name=file.target_name||file.name}
if(chunkSize&&canSliceBlob&&blob.size>chunkSize){curChunkSize=Math.min(chunkSize,blob.size-offset);chunkBlob=blob.slice(offset,offset+curChunkSize)}else{curChunkSize=blob.size;chunkBlob=blob}
if(chunkSize&&canSliceBlob){if(_options.send_chunk_number){data.chunk=Math.ceil(offset/chunkSize);data.chunks=Math.ceil(blob.size/chunkSize)}else{data.offset=offset;data.total=blob.size}}
xhr=new o.XMLHttpRequest();if(xhr.upload){xhr.upload.onprogress=function(e){file.loaded=Math.min(file.size,offset+e.loaded);if(file.size){file.percent=Math.ceil(file.loaded/file.size*100)}
file.trigger(e)}}
xhr.onload=function(){if(xhr.status>=400){handleError();return}
retries=_options.max_retries;if(curChunkSize<blob.size){chunkBlob.destroy();offset+=curChunkSize;file.loaded=Math.min(offset,blob.size);file.percent=Math.ceil(file.loaded/file.size*100);file.trigger('ChunkUploaded',{offset:file.loaded,total:blob.size,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});if(o.Env.browser==='Android Browser'){file.trigger({type:'Progress',loaded:file.loaded,total:blob.size})}}else{file.loaded=file.size}
chunkBlob=formData=null;if(!offset||offset>=blob.size){if(file.size!=file.origSize){blob.destroy();blob=null}
file.percent=100;file.trigger({type:'Progress',loaded:file.loaded,total:file.size});file.status=plupload.DONE;file.trigger('Uploaded',{response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()})}else{delay(uploadNextChunk,1)}};xhr.onerror=function(){handleError()};xhr.onloadend=function(){this.destroy();xhr=null};if(_options.multipart&&canSendMultipart){xhr.open(_options.http_method,url,!0);plupload.each(_options.headers,function(value,name){xhr.setRequestHeader(name,value)});formData=new o.FormData();plupload.each(plupload.extend(data,_options.multipart_params),function(value,name){formData.append(name,value)});formData.append(_options.file_data_name,chunkBlob);xhr.send(formData)}else{url=plupload.buildUrl(_options.url,plupload.extend(data,_options.multipart_params));xhr.open(_options.http_method,url,!0);if(plupload.isEmptyObj(_options.headers)||!_options.headers['content-type']){xhr.setRequestHeader('content-type','application/octet-stream')}
plupload.each(_options.headers,function(value,name){xhr.setRequestHeader(name,value)});xhr.send(chunkBlob)}}
if(file.loaded){offset=file.loaded=chunkSize*Math.floor(file.loaded/chunkSize)}
if(!plupload.isEmptyObj(_options.resize)&&file.isImage()&&runtimeCan(blob,'send_binary_string')){resizeImage.call(this,blob,_options.resize,function(resizedBlob){blob=resizedBlob;file.size=resizedBlob.size;uploadNextChunk()})}else{uploadNextChunk()}},cancelUpload:function(){if(xhr){xhr.abort();xhr.destroy();xhr=null}},destroy:function(){this.cancelUpload();this.unbindAll();var src=this.getSource();if(src){src.destroy();delete filepool[this.id]}
_options=null}});filepool[this.id]=file;function runtimeCan(blob,cap){if(blob.ruid){var info=o.Runtime.getInfo(blob.ruid);if(info){return info.can(cap)}}
return!1}
function resizeImage(blob,params,cb){var img=new o.Image();try{img.onload=function(){if(params.width>this.width&&params.height>this.height&&params.quality===undef&&params.preserve_headers&&!params.crop){this.destroy();return cb(blob)}
img.downsize(params.width,params.height,params.crop,params.preserve_headers)};img.onresize=function(){cb(this.getAsBlob(blob.type,params.quality));this.destroy()};img.onerror=function(){cb(blob)};img.load(blob)}catch(ex){cb(blob)}}}
plupload.extend(PluploadFile,{QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,RESIZING:6});PluploadFile.prototype=o.EventTarget.instance;return PluploadFile}());var QueueProgress=function(){var self=this;self.size=0;self.loaded=0;self.uploaded=0;self.failed=0;self.queued=0;self.percent=0;self.bytesPerSec=0;self.reset=function(){self.size=self.loaded=self.uploaded=self.failed=self.queued=self.percent=self.bytesPerSec=0}};var Collection=function(){var registry={};this.length=0;this.get=function(key){return registry.hasOwnProperty(key)?registry[key]:null};this.add=function(key,obj){if(registry.hasOwnProperty(key)){return this.update.apply(this,arguments)}
registry[key]=obj;this.length++};this.remove=function(key){if(registry.hasOwnProperty(key)){delete registry[key];this.length--}};this.update=function(key,obj){registry[key]=obj};this.each=function(cb){plupload.each(registry,cb)};this.clear=function(){registry={};this.length=0}};window.plupload=plupload}(window,mOxie))